#!/bin/sh
BUILD_DIR=$1

echo "Installing zsign dependencies..."

apt-get update
apt-get install -y git make g++ pkg-config \
    libssl-dev zlib1g-dev libzip-dev unzip

echo "Cloning zsign..."
git clone https://github.com/zhlynn/zsign.git /tmp/zsign

echo "Building zsign..."
cd /tmp/zsign/build/linux

make clean && make

if [ ! -f "zsign" ]; then
    echo "❌ zsign build failed!"
    exit 1
fi

mkdir -p $BUILD_DIR/bin
cp zsign $BUILD_DIR/bin/zsign
chmod +x $BUILD_DIR/bin/zsign

echo "✅ zsign installed at $BUILD_DIR/bin/zsign"
