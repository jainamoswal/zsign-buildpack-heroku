#!/bin/bash
set -e

BUILD_DIR=$1
CACHE_DIR=$2

echo ">>> Cloning and building zsign..."

git clone https://github.com/zhlynn/zsign.git zsign
cd zsign/build/linux

make clean
make

# Define the path to the built binary
ZBIN="../../bin/zsign"

# Check if the binary was built successfully
if [ ! -f "$ZBIN" ]; then
    echo "❌ Build failed: zsign binary not found at $ZBIN"
    exit 1
fi

echo ">>> Moving zsign to bin directory..."
mkdir -p "$BUILD_DIR/bin"
cp "$ZBIN" "$BUILD_DIR/bin/"
chmod +x "$BUILD_DIR/bin/zsign"

echo "✅ zsign built and installed at $BUILD_DIR/bin/zsign"
